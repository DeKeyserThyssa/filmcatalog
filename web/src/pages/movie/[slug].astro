---
import Layout from '../../layouts/Layout.astro'

export async function getStaticPaths() {
  const movies = await fetch(
    `https://api.themoviedb.org/3/trending/movie/day?api_key=${
      import.meta.env.API_KEY
    }`,
  ).then((res) => res.json())

  return movies.results.map((el: any) => ({
    params: {
      slug: el.id
    },
  }))
}
const { slug } = Astro.params
const data = await fetch(
  `https://api.themoviedb.org/3/movie/${slug}?api_key=${
    import.meta.env.API_KEY
  }&language=en-US`,
).then((res) => res.json())
console.log(data)
---

<Layout title={data?.title}>
  <section class="grid grid-cols-7 gap-3 pt-24">
    <div class="col-start-2">
      <img
        class="aspect-[2/3]"
        src={`https://image.tmdb.org/t/p/original${data.poster_path}`}
        alt=""
      />
    </div>
    <div class="col-start-4 col-span-3">
      <h1 class="text-4xl">
        {data.title} ({new Date(data.release_date).getFullYear()})
      </h1>
      <h2 class="text-2xl">Overview</h2>
      <p>{data.overview}</p>
      <div>
        <h2 class="text-2xl">Companies</h2>
        <ul class="flex flex-column">
          {data.production_companies.map((el: any) => (
            <li class="mr-3">{el.name}</li>
          ))}
        </ul>
      </div>
      <div>
        <h2 class="text-2xl">Genres</h2>
        <ul class="flex flex-column">
          {data.genres.map((el: any) => (
            <li class="mr-3">{el.name}</li>
          ))}
        </ul>
      </div>
    </div>
  </section>
</Layout>
